<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="renderer" content="webkit">
    <title></title>  
<link rel="stylesheet" href="/NfCrm/resources/css/pintuer.css">
<link rel="stylesheet" href="/NfCrm/resources/css/admin.css">
<script src="/NfCrm/resources/js/jquery.min.js"></script>
<script src="/NfCrm/resources/js/pintuer.js"></script>
<link rel="stylesheet" href="/NfCrm/resources/alert/sweet-alert.css">
<script type="text/javascript" src="/NfCrm/resources/alert/sweet-alert.min.js"></script>
<style type="text/css">
.label{
	float: left;
	line-height: 42px;
	margin-right: 5px;
	margin-left: 130px;
}
</style>
</head>
<body>

  <div class="panel admin-panel">
    <div class="panel-head"><strong class="icon-reorder">添加模板内容</strong></div>
    <div class="padding border-bottom">
      <ul class="search">
        <li>
          
        </li>
      </ul>
    </div>
    
    <table id="tab" class="table table-hover text-center">
      	<tr>
      		<td colspan="2">
      			<div class="form-group"
					style="display: block;width: 50%; margin: 0px auto;">
					<div class="label">
						<label>模板名称</label>
					</div>
					<div class="field">
						<input type="text" class="input w50" id="remark" name="template_name" data-validate="required:模板名称必填!"/>
					</div>
				</div>
      			
      		</td>
      	</tr>
      	
        <tr>
           <td>
           	<input type="hidden"  name="keytId" value="" />
           	<input type="text"  name="key_name" data-validate="required:请输入正确格式" >
           	<input type="button" value="绑定" name="testChange" class="button border-red" style="padding:5px 15px;" />
           	
           	<div id="fade" style="display: none;border:3px solid #eee;width:200px;margin-left: 250px; margin-top: 5px;">
  				
  				<select name="select1"  style="width: 100%;" onchange="check1(this.options[this.selectedIndex].value);">
						<option value="">请选择</option>
						
				</select>
				<table style="text-align: center;margin-top: 10px;">
						<tr name="inpu">
						</tr>
						<tr>
							<td colspan="2">
								<input type="button" name="btn" value="确定" class="button border-red" style="padding:5px 15px;" /> 
							</td>
						</tr>
				</table>
  			</div>
           </td>
           
          <td>
          	  <input type="hidden"  name="valtId" value="" />
	          <input name="value" type="text"  data-validate="required:请输入数据" readonly="readonly"/>
	          <input type="button" value="绑定" name="testChange" class="button border-red" style="padding:5px 15px;" /> 
	 			<div id="fade" style="display: none;border:3px solid #eee;width:200px;margin-left: 250px; margin-top: 5px;">
  				
  				<select name="select1"  style="width: 100%;" onchange="check1(this.options[this.selectedIndex].value);">
						<option value="">请选择</option>
						
				</select>
				<table style="text-align: center;margin-top: 10px;">
						<tr name="inpu">
						</tr>
						<tr>
							<td colspan="2">
								<input type="button" name="btn" value="确定" class="button border-red" style="padding:5px 15px;" /> 
							</td>
						</tr>
				</table>
  			</div>
	      </td>
          
        </tr>
        
        <tr>
           <td>
            <input type="hidden"  name="keytId" value="" />
           	<input type="text" name="key_name" >
           	<input type="button" value="绑定" name="testChange" class="button border-red" style="padding:5px 15px;" />
           	<div id="fade" style="display: none;border:3px solid #eee;width:200px;margin-left: 250px; margin-top: 5px;">
  				
  				<select name="select1"  style="width: 100%;" onchange="check1(this.options[this.selectedIndex].value);">
						<option value="">请选择</option>
						
				</select>
				<table style="text-align: center;margin-top: 10px;">
						<tr name="inpu" >
						</tr>
						<tr>
							<td colspan="2">
								<input type="button" name="btn" value="确定" class="button border-red" style="padding:5px 15px;" /> 
							</td>
						</tr>
				</table>
  			</div>
           </td>
          <td>
          <input type="hidden"  name="valtId" value="" />
          <input name="value" type="text" readonly="readonly"/>
          <input type="button" value="绑定" name="testChange" class="button border-red" style="padding:5px 15px;" /> 
          
	 		<div id="fade" style="display: none;border:3px solid #eee;width:200px;margin-left: 250px; margin-top: 5px;">
  				
  				<select name="select1"  style="width: 100%;" onchange="check1(this.options[this.selectedIndex].value);">
						<option value="">请选择</option>
						
				</select>
				<table style="text-align: center;margin-top: 10px;">
						<tr name="inpu" >
						</tr>
						<tr>
							<td colspan="2">
								<input type="button" name="btn" value="确定" class="button border-red" style="padding:5px 15px;" /> 
							</td>
						</tr>
				</table>
  			</div>
	      </td>
        </tr>
        
        
    </table>
    
    <table class="table table-hover text-center">
        <tr>
        	<td colspan="2">
        		<input id="cr" class="button border-red icon-plus" value="+" type="button">
        	</td>
        </tr>
      	<tr>
          <td colspan="2">
          <button type="submit" class="button border-red" style="padding:5px 15px;"  id="submit"> 
	        	保存
	      </button>
	      </td>
        </tr>
    </table>
	
  </div>
  <table style="display: none;">
    <tr name="cr" >
           <td>
           	<input type="hidden"  name="keytId" value="" />
           	<input type="text"  name="key_name" data-validate="required:请输入正确格式" />
           	<input type="button" value="绑定" name="testChange" class="button border-red" style="padding:5px 15px;" />
           	
           	<div id="fade" style="display: none;border:3px solid #eee;width:200px;margin-left: 250px; margin-top: 5px;">
  				
  				<select name="select1"  style="width: 100%;" onchange="check1(this.options[this.selectedIndex].value);">
						<option value="">请选择</option>
						
				</select>
				<table style="text-align: center;margin-top: 10px;">
						<tr name="inpu">
						</tr>
						<tr>
							<td colspan="2">
								<input type="button" name="btn" value="确定" class="button border-red" style="padding:5px 15px;" /> 
							</td>
						</tr>
				</table>
  			</div>
           </td>
           
          <td>
          	  <input type="hidden"  name="valtId" value="" />
	          <input name="value" type="text"  data-validate="required:请输入数据" readonly="readonly"/>
	          <input type="button" value="绑定" name="testChange" class="button border-red" style="padding:5px 15px;" /> 
	 			<div id="fade" style="display: none;border:3px solid #eee;width:200px;margin-left: 250px; margin-top: 5px;">
  				
  				<select name="select1"  style="width: 100%;" onchange="check1(this.options[this.selectedIndex].value);">
						<option value="">请选择</option>
						
				</select>
				<table style="text-align: center;margin-top: 10px;">
						<tr name="inpu">
						</tr>
						<tr>
							<td colspan="2">
								<input type="button" name="btn" value="确定" class="button border-red" style="padding:5px 15px;" /> 
							</td>
						</tr>
				</table>
  			</div>
	      </td>
          
        </tr>
        </table>
  
  <div id="fade" class="black_overlay">
  		
  </div>
<script type="text/javascript">

	
	$(function() {
		$("#cr").click(function() {
			
			var obj=$("[name='cr']").html();
			var trHTML="<tr>"+obj+"</tr>";
			$("[name='tab']").append(trHTML);
	        
	       	$("#tab").append(trHTML); 
			
		    $("[name='btn']").click(function () {  
		        var str = "";
		        var strftype="";
		        var items = $("input:checkbox:checked");
		        for (var i = 0; i < items.length; i++) {
		        	if((i+1)==items.length){
		        		str+=items[i].value+"";
		        		strftype+=items[i].name+"";
		        	}else{
		        		str+=items[i].value+",";
		        		strftype+=items[i].name+",";
		        	}
				}
		      	$(this).parent().parent().parent().parent().parent().parent().children("input[type='text']").val(str);
		      	$(this).parent().parent().parent().parent().parent().parent().children("input[type='hidden']").val(strftype);
		        $(this).parent().parent().parent().parent().parent().hide();
		    });  
		    
		    
		 	$("input[name='testChange']").click(function () {  

		 		$(this).siblings("div").show();
		       
		    }); 
		});
	});
	
	//select下拉框的改变事件
	function check1(v){
		
		var op=v;
		
		var data = {
			function_type:op
		}
		
		$.ajax({
			type: "POST",
			url: "/NfCrm/dateDictionary/selectDateDictionType.do",
			dataType : "json",
			data:data,
			success: function(msg){
				var datamap=msg.list;//得到json数据赋给datamap
				$("[name='inpu']").html("");
				$.each(datamap, function (index, val) {
			        $("[name='inpu']").append("<td><input name='"+this.d_id+"' type='checkbox' value='"+this.d_key+"'/>"+this.d_key+"</td>");
			    });
			}
		});
		
	} 
	//将后台传输的值插入select下拉框
	$(document).ready(function(){
		
	    $.ajax({
			type: "POST",
			url: "/NfCrm/dateDictionary/selectDateDiction.do",
			dataType : "json",
			success: function(data){
				var datamap=data.list;//得到json数据赋给datamap
				
				$.each(datamap, function (index, val) {
			        $("[name='select1']").append("<option value='" + this.function_type + "'>" + this.function_type_name + "</option>");
			    });
			}
		});
	   
	   	
	});
	
    $("[name='btn']").click(function () { 
    	
        var str = "";
        var strftype="";
        var items = $("input:checkbox:checked");
        
        for (var i = 0; i < items.length; i++) {
        	if((i+1)==items.length){
        		str+=items[i].value+"";
        		strftype+=items[i].name+"";
        	}else{
        		str+=items[i].value+",";
        		strftype+=items[i].name+",";
        	}
		}
        $(this).parent().parent().parent().parent().parent().parent().children("input[type='text']").val(str);
        $(this).parent().parent().parent().parent().parent().parent().children("input[type='hidden']").val(strftype);
        $(this).parent().parent().parent().parent().parent().hide();
        
    });  
    

    
    //点击保存
    $("#submit").click(function () {  
    	
    	var tempname = $("input[name='template_name']").val();
    	var valItems = $("input[name='value']");
    	var keyItems = $("input[name='key_name']");
    	var keyIdItems=$("input[name='keytId']");
    	var valIdItems=$("input[name='valtId']");
    	var keyStr = "";
    	var valStr = "";
    	var keytIdstr="";
		var valtIdstr="";
		
    	if(($("input[name='value']").val()==null||$("input[name='value']").val()=="")||
    			($("input[name='key_name']").val()==null||$("input[name='key_name']").val()=="")){
    		alert("请至少输入一行信息！");
    		return false;
    	}else{ 
    		for (var i = 0; i < keyItems.length; i++) {
    			if(i== keyItems.length-2){
    				keyStr+=keyItems[i].value+"";
    				keytIdstr+=keyIdItems[i].value+"";
    			}else{
    				keyStr+=keyItems[i].value+"\|-";
    				keytIdstr+=keyIdItems[i].value+"\|-";
    			}
    			if(i==keyItems.length-2){
    				break;
    			}
    		}
        	for (var j = 0; j < valItems.length; j++) {
    			if(j== valItems.length-2){
    				valStr+=valItems[j].value+"";
    				valtIdstr+=valIdItems[j].value+"";
    			}else{
    				valStr+=valItems[j].value+"\|-";
    				valtIdstr+=valIdItems[j].value+"\|-";
    			}
    			if(j==valItems.length-2){
    				break;
    			}
    		}
    	}
		var data = {
				tempname:tempname,
				keyStr:keyStr,
				keytIdstr:keytIdstr,
				valStr:valStr,
				valtIdstr:valtIdstr
		};
    	$.ajax({
			type: "POST",
			url: "/NfCrm/template/addTemplate.do",
			dataType : "json",
			data:data,
			success: function(data){
				if(data.code=="000"){
					swal({title: "系统提示",text: "新增成功！",type: "success",showCancelButton: false,confirmButtonColor: "#DD6B55",confirmButtonText: "确定"
	        		},
	        		function(){
	        			window.location="/NfCrm/template/selectTemplate.do";
	        		});
				}
			},error: function(){
				swal({title: "系统提示",text: "新增失败！",type: "success",showCancelButton: false,confirmButtonColor: "#DD6B55",confirmButtonText: "确定"
        		})
			}
		});
       
    });
    

 	$("input[name='testChange']").click(function () {  

 		$(this).siblings("div").show();
       
    });  
 
	
		
	
</script>
</body></html>